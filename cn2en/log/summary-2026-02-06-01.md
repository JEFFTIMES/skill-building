# cn2en design + implementation summary (2026-02-06)

## Design overview

- Workflow is human-in-the-loop: extract Chinese text blocks into placeholders, translate block-by-block, then reinsert.
- Preserves Markdown structure by keeping headings, list prefixes, and blockquote prefixes intact.
- YAML front matter and fenced code blocks are left unchanged.
- Produces a sibling file (`foo.md` -> `foo.en.md`) and a blocks file (`foo.en.blocks.json`).
- Glossary is append-only JSONL for consistent terminology across jobs.

## Implementation summary

- `cn2en/scripts/extract_cn_blocks.py`
  - Copies input to `.en.md` and replaces CN text with placeholders like `[[CN2EN_BLOCK_0001]]`.
  - Writes `*.en.blocks.json` with `{index, placeholder, text}` entries.
  - Skips YAML front matter and fenced code blocks.
  - Detects CN text via Unicode range `\u4e00-\u9fff`.
- `cn2en/scripts/insert_en_blocks.py`
  - Reads translations from JSON/JSONL and replaces placeholders in the skeleton file.
  - Supports list, dict, and JSONL mapping formats.
- Tests
  - `cn2en/tests/test_extract_insert.py` validates extract -> translate -> insert.
  - `cn2en/tests/test_append_glossary.py` validates glossary helper behavior.

## Open items

- Decide translation backend (manual, local model, etc.).
- Consider expanding parsing to handle inline links text vs. URLs.
